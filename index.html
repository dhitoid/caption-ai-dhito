<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Caption AI</title>

<meta name="theme-color" content="#38bdf8" />

<style>
:root{
  --bg:#f8fafc;
  --card:#fff;
  --primary:#38bdf8;
  --primary-dark:#0ea5e9;
  --text:#0f172a;
  --muted:#64748b;
  --border:#e5e7eb;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Inter",sans-serif;
  background:linear-gradient(180deg,#f0f9ff,var(--bg));
  color:var(--text);
}
header{
  display:flex;justify-content:space-between;align-items:center;
  padding:14px 20px;
  background:#ffffffcc;backdrop-filter:blur(10px);
  border-bottom:1px solid var(--border);
}
.brand{font-weight:700;color:var(--primary-dark)}
.auth{position:relative}
.login-btn{
  background:var(--primary);color:#fff;border:none;
  padding:8px 14px;border-radius:8px;cursor:pointer;
}
.avatar{
  width:36px;height:36px;border-radius:50%;
  cursor:pointer;display:none;
}
.dropdown{
  position:absolute;right:0;top:46px;
  background:#fff;border:1px solid var(--border);
  border-radius:10px;display:none;
}
.dropdown button{
  background:none;border:none;padding:10px 16px;
  width:100%;text-align:left;cursor:pointer;
}
main{max-width:540px;margin:auto;padding:24px 20px}
.card{
  background:var(--card);border:1px solid var(--border);
  border-radius:18px;padding:20px;margin-bottom:20px;
}
label{font-size:13px;color:var(--muted)}
input{
  width:100%;padding:12px;margin-bottom:14px;
  border-radius:12px;border:1px solid var(--border);
}

/* ===== CUSTOM SELECT ===== */
.select{
  border:1px solid var(--border);
  border-radius:12px;padding:12px;
  margin-bottom:14px;cursor:pointer;
}
.select-options{
  display:none;margin-top:8px;
  border:1px solid var(--border);
  border-radius:10px;overflow:hidden;
}
.select-options div{
  padding:10px;background:#fff;
}
.select-options div:hover{background:#f1f5f9}

.primary{
  width:100%;
  background:linear-gradient(135deg,var(--primary),var(--primary-dark));
  color:#fff;border:none;padding:14px;
  border-radius:14px;font-weight:600;
}
.result{
  background:#f8fafc;border:1px dashed var(--border);
  border-radius:14px;padding:16px;min-height:90px;
  white-space:pre-line;
}
.copy{
  margin-top:12px;background:#e0f2fe;
  border:none;padding:10px;width:100%;
  border-radius:10px;font-weight:600;
}
footer{text-align:center;font-size:12px;color:var(--muted);padding:20px}
</style>
</head>

<body>

<header>
  <div class="brand">Caption AI</div>
  <div class="auth">
    <button id="loginBtn" class="login-btn">Login Google</button>
    <img id="avatar" class="avatar">
    <div id="dropdown" class="dropdown">
      <button id="logoutBtn">Logout</button>
    </div>
  </div>
</header>

<main>
  <p id="limitInfo"></p>
  <h1 id="welcome">Buat Caption Otomatis</h1>

  <div class="card">
    <label>Platform</label>
    <div id="platformSelect" class="select">Instagram</div>
    <div id="platformOpt" class="select-options">
      <div>Instagram</div><div>WhatsApp</div><div>TikTok</div>
    </div>

    <label>Produk / Jasa</label>
    <input id="product" placeholder="Contoh: Rumah subsidi">

    <label>Gaya Bahasa</label>
    <div id="styleSelect" class="select">Soft selling</div>
    <div id="styleOpt" class="select-options">
      <div>Soft selling</div><div>Hard selling</div>
      <div>Santai</div><div>Profesional</div>
    </div>

    <button id="generate" class="primary">ðŸš€ Buat Caption</button>
  </div>

  <div class="card">
    <div id="result" class="result">â€”</div>
    <button id="copy" class="copy">ðŸ“‹ Salin Caption</button>
  </div>
</main>

<footer>Â© 2026 Caption AI Â· By DHITO</footer>

<script type="module">
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

const supabase = createClient(
  'https://lgkbrgwgdgqfhidjivcr.supabase.co',
  'PUBLIC_ANON_KEY',
  { auth:{ flowType:'pkce', detectSessionInUrl:true, persistSession:true } }
)

/* ===== ELEMENT ===== */
const loginBtn = document.getElementById('loginBtn')
const avatar = document.getElementById('avatar')
const dropdown = document.getElementById('dropdown')
const logoutBtn = document.getElementById('logoutBtn')
const welcome = document.getElementById('welcome')
const limitInfo = document.getElementById('limitInfo')

let currentUser = null
const DAILY_LIMIT = 5

/* ===== AUTH ===== */
loginBtn.onclick = () =>
  supabase.auth.signInWithOAuth({
    provider:'google',
    options:{ redirectTo: location.origin + location.pathname }
  })

logoutBtn.onclick = async () => {
  await supabase.auth.signOut()
  currentUser = null
  loginBtn.style.display='block'
  avatar.style.display='none'
  dropdown.style.display='none'
}

/* ===== SESSION ===== */
const { data } = await supabase.auth.getSession()
if(data.session) handleLogin(data.session.user)

supabase.auth.onAuthStateChange((_, session)=>{
  if(session?.user) handleLogin(session.user)
})

function handleLogin(user){
  currentUser = user
  loginBtn.style.display='none'
  avatar.style.display='block'
  avatar.src = user.user_metadata.picture
  welcome.innerText = 'ðŸ‘‹ Halo, ' + user.user_metadata.full_name
  updateLimitUI()
}

/* ===== LIMIT ===== */
function today(){return new Date().toISOString().slice(0,10)}
function getUsage(){
  const d=`d_${currentUser.id}`,c=`c_${currentUser.id}`
  if(localStorage.getItem(d)!==today()){
    localStorage.setItem(d,today());localStorage.setItem(c,0)
  }
  return +localStorage.getItem(c)
}
function inc(){localStorage.setItem(`c_${currentUser.id}`,getUsage()+1)}
function updateLimitUI(){
  limitInfo.innerText =
    `Gratis: ${DAILY_LIMIT-getUsage()} dari ${DAILY_LIMIT} hari ini`
}

/* ===== CUSTOM SELECT ===== */
function setupSelect(btn,opt){
  btn.onclick=()=>opt.style.display=opt.style.display?'':'block'
  opt.querySelectorAll('div').forEach(v=>{
    v.onclick=()=>{btn.innerText=v.innerText;opt.style.display='none'}
  })
}
setupSelect(platformSelect,platformOpt)
setupSelect(styleSelect,styleOpt)

/* ===== GENERATE ===== */
generate.onclick = ()=>{
  if(!currentUser) return alert('Login dulu')
  if(getUsage()>=DAILY_LIMIT) return alert('Limit habis')
  result.innerText =
`${product.value}
Solusi ${styleSelect.innerText} untuk ${platformSelect.innerText}`
  inc();updateLimitUI()
}
copy.onclick=()=>navigator.clipboard.writeText(result.innerText)
</script>

</body>
</html>
